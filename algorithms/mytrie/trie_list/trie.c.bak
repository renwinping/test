#include "trie.h"
#include ""

int trie_init(TRIE *root)
{
    root->left = root->right = NULL;
    root->parent = NULL;
    root->child = NULL;
    root->isvalid = 0;
    root->count = 0;
}

int trie_insert(TRIE *root, const char *word)
{
    TRIE *location = root, *e, *head;
    int flag = 0;
     
    while (location && *word != '\0'){
        e = location->child;
        head = e;
        flag = 0;

        for (e; e != head; e=e->right){
            if (e->key == *word){
                location = e;
                flag = 1;
                break;
            }
        }

        if (!flag){
            e = (TRIE *)malloc(sizeof(TRIE));
            if (!e){
                return -1;
            }
            trie_init(e);

            e->key = *word;
            head->left = e
            e->right = head;
            e->left = head;
            head->left->right = e;
            head->left = e;
            e->parent = location;
        }
        word++;
    }

    if (*word == '\0'){
        e->isvalid = 1;
        e->count += 1;
    }
    
    return 0;
}

TRIE *trie_search(TRIE *root, const char *word)
{
    TRIE *location = root, *e, *head;
    int flag = 0;
     
    while (location && *word != '\0'){
        e = location->child;
        head = e;
        flag = 0;

        for (e; e != head; e=e->right){
            if (e->key == *word){
                location = e;
                flag = 1;
                break;
            }
        }

        if (!flag)
            break;

        word++;
    }

    if (*word == '\0' && flag && location){
        return location;
    }else{
        return NULL;
    }
}

#ifdef TEST

const char *help = "\t\t\t2:查询\n"
                   "\t\t\t1:插入\n"
                   "\t\t\t3:退出\n";

int main(int argc, char *argv[])
{
    int option;
    char buf[128];

    printf("usage:%s", help);
    struct trie_node trie, *ptr;
    init_trie_node(&trie);

    while (1) 
    {
        printf("input your choose:");
        fflush(stdout);
        scanf("%d", &option); 
        /*printf("\n");*/

       switch (option)
       {
           case 1:
              printf("input the word you want to insert:");
              fflush(stdout);
              scanf("%s", buf);
              if (buf[strlen(buf) - 1] == '\n')
                  buf[strlen(buf) - 1] = '\0';
              trie_insert(&trie, buf); 
              /*printf("\n");*/
              break;
            case 2:
              printf("input the word you want to search:");
              fflush(stdout);
              scanf("%s", buf);
              if (buf[strlen(buf) - 1] == '\n')
                  buf[strlen(buf) - 1] = '\0';
              ptr = trie_search(&trie, buf);
              if (!ptr){
                  printf("%s is not exist!\n", buf);
                  continue;
              }
              /*printf("\n");*/
              printf("%s is exist!, number is %d\n", buf, ptr->count);
              break;
            case 3:
              printf("over\n");
              goto OUT; 
       }
    }
OUT:
    trie_display(&trie);
    trie_free(&trie);
    /*trie_display(&trie);*/
    return 0;
}
#endif



